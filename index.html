<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Blaster: Infinity Siege</title>
<meta name="author" content="Aditya">

<style>
body {
  background:#111;
  color:white;
  text-align:center;
  font-family:Arial;
}
canvas {
  background:#222;
  border:2px solid white;
  display:none;
  margin:auto;
}
button,input {
  padding:10px;
  font-size:16px;
  margin:6px;
}
</style>
</head>
<body>

<h1>ðŸŽ® Neon Blaster: Infinity Siege</h1>

<div id="login">
  <input id="username" placeholder="Username"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <button onclick="register()">Create Account</button>
</div>

<div id="menu" style="display:none;">
  <p id="welcome"></p>
  <button onclick="startGame('story')">Story Mode</button>
  <button onclick="startGame('infinite')">Infinity Mode</button>
  <button onclick="openShop()">Gun Shop</button><br>
  <button onclick="logout()">Logout</button>
</div>

<div id="shop" style="display:none;">
  <p id="shopInfo"></p>
  <button onclick="buyGun('fast')">Fast Gun (10)</button>
  <button onclick="buyGun('rapid')">Rapid Gun (25)</button><br>
  <button onclick="goToMenu()">Back</button>
</div>

<div id="hud"></div>
<button id="backBtn" onclick="goToMenu()" style="display:none;">Back</button>

<canvas id="game" width="800" height="450"></canvas>

<script>
/* ===== ACCOUNTS ===== */
let accounts = JSON.parse(localStorage.getItem("accounts")) || {};
let currentUser = null;
function save(){ localStorage.setItem("accounts", JSON.stringify(accounts)); }

function register(){
  if(!username.value || !password.value) return alert("Fill fields");
  if(accounts[username.value]) return alert("User exists");
  accounts[username.value] = {
    password: password.value,
    coins: 0,
    guns: ["normal"],
    equipped: "normal"
  };
  save(); alert("Account created");
}

function login(){
  let a = accounts[username.value];
  if(!a || a.password !== password.value) return alert("Invalid login");
  currentUser = username.value;
  login.style.display = "none";
  menu.style.display = "block";
  welcome.innerText = "Welcome " + currentUser;
}

function logout(){
  menu.style.display = "none";
  login.style.display = "block";
}

/* ===== GAME ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let STATE="MENU", mode="";
let player, enemies=[], bullets=[];
let level=1, wave=1, lives=5;
let keys={}, mouse={x:0,y:0};
let fireRate=400, lastShot=0;

/* Damage cooldown */
let invincible=false;
let invTime=0;
const INV_DURATION=1000;

/* ===== MENU ===== */
function startGame(m){
  mode=m; STATE="PLAY";
  level=1; wave=1; lives=5;
  player={x:400,y:350,r:15,speed:4};
  enemies=[]; bullets=[];
  fireRate =
    accounts[currentUser].equipped==="rapid" ? 100 :
    accounts[currentUser].equipped==="fast" ? 200 : 400;
  spawnWave();
  menu.style.display="none";
  canvas.style.display="block";
  backBtn.style.display="inline-block";
}

function goToMenu(){
  STATE="MENU";
  canvas.style.display="none";
  backBtn.style.display="none";
  shop.style.display="none";
  menu.style.display="block";
  hud.innerText="";
}

function openShop(){
  menu.style.display="none";
  shop.style.display="block";
  shopInfo.innerText=`Coins: ${accounts[currentUser].coins}`;
}

function buyGun(t){
  let a=accounts[currentUser];
  if(a.guns.includes(t)){ a.equipped=t; save(); return; }
  if(t==="fast" && a.coins>=10){ a.coins-=10; a.guns.push(t); }
  else if(t==="rapid" && a.coins>=25){ a.coins-=25; a.guns.push(t); }
  else return alert("Not enough coins");
  a.equipped=t; save(); openShop();
}

/* ===== WAVES & ENEMIES ===== */
function spawnWave(){
  enemies=[];
  let count = 3 + wave;
  let boss =
    (mode==="story" && level===5) ||
    (mode==="infinite" && level%5===0 && wave===3);

  if(boss){
    enemies.push({
      x:400,y:120,r:35,
      vx:2,vy:2,
      maxHp:50 + level*10,
      hp:50 + level*10,
      boss:true
    });
    return;
  }

  for(let i=0;i<count;i++){
    let hp = 5 + level*2 + wave;   // âœ… MULTI-HP ENEMIES
    enemies.push({
      x:Math.random()*700+50,
      y:Math.random()*200+50,
      r:18,
      vx:2+level*0.2,
      vy:2+level*0.2,
      maxHp:hp,
      hp:hp,
      boss:false
    });
  }
}

/* ===== INPUT ===== */
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);
canvas.addEventListener("mousemove",e=>{
  let r=canvas.getBoundingClientRect();
  mouse.x=e.clientX-r.left;
  mouse.y=e.clientY-r.top;
});
canvas.addEventListener("click",()=>{
  if(Date.now()-lastShot<fireRate)return;
  lastShot=Date.now();
  let a=Math.atan2(mouse.y-player.y,mouse.x-player.x);
  bullets.push({
    x:player.x,y:player.y,
    vx:Math.cos(a)*7,
    vy:Math.sin(a)*7
  });
});

/* ===== LOOP ===== */
function update(){
  if(keys.w&&player.y>20)player.y-=player.speed;
  if(keys.s&&player.y<430)player.y+=player.speed;
  if(keys.a&&player.x>20)player.x-=player.speed;
  if(keys.d&&player.x<780)player.x+=player.speed;

  enemies.forEach(e=>{
    e.x+=e.vx; e.y+=e.vy;
    if(e.x<e.r||e.x>800-e.r)e.vx*=-1;
    if(e.y<e.r||e.y>450-e.r)e.vy*=-1;
  });

  bullets.forEach(b=>{b.x+=b.vx;b.y+=b.vy;});
  bullets=bullets.filter(b=>{
    for(let e of enemies){
      if(Math.hypot(b.x-e.x,b.y-e.y)<e.r){
        e.hp--; return false;
      }
    }
    return true;
  });

  enemies=enemies.filter(e=>{
    if(e.hp<=0){
      accounts[currentUser].coins+=e.boss?5:1;
      save(); return false;
    }

    if(Math.hypot(player.x-e.x,player.y-e.y)<player.r+e.r){
      if(!invincible){
        lives--;
        invincible=true;
        invTime=Date.now();
        if(lives<=0){ alert("GAME OVER"); goToMenu(); }
      }
    }
    return true;
  });

  if(invincible && Date.now()-invTime>INV_DURATION){
    invincible=false;
  }

  if(enemies.length===0){
    wave++;
    if(wave>3){ wave=1; level++; }
    spawnWave();
  }
}

function draw(){
  ctx.clearRect(0,0,800,450);

  ctx.fillStyle=invincible?"#0ff":"cyan";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fill();

  enemies.forEach(e=>{
    let hpRatio = e.hp / e.maxHp;
    ctx.fillStyle = e.boss
      ? "purple"
      : `rgb(${255*hpRatio},0,0)`;   // ðŸ”¥ HP feedback
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
    ctx.fill();
  });

  ctx.fillStyle="yellow";
  bullets.forEach(b=>ctx.fillRect(b.x,b.y,4,4));

  hud.innerText =
    `Lives:${lives} | Level:${level} | Wave:${wave} | Coins:${accounts[currentUser].coins}`;
}

function loop(){
  if(STATE==="PLAY"){ update(); draw(); }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>




